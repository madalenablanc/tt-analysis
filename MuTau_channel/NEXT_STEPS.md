# Next Steps for Advisor Meeting

## 1. Generate Diagnostic Plots (ON LXPLUS)

```bash
cd /afs/cern.ch/user/m/mblancco/tau_analysis/MuTau_channel
bash run_diagnostics.sh
```

This will create all plots in the `diagnostic_plots/` directory.

## 2. Review the Presentation

Open [SIMPLE_PRESENTATION.pdf](SIMPLE_PRESENTATION.pdf) - it's ready for your advisor meeting with:
- Problem statement (Data/QCD at 50% of expected)
- Diagnostic results (99.95% rejection at Tau ID step)
- Root cause analysis (wrong tau selection picking highest pT tau with VSmu=0)
- Diagnostic plots (will be generated by step 1)
- Proposed solution

## 3. Key Questions for Advisors

1. **What is the standard for selecting taus in MuTau analysis?**
   - Should we pick highest pT tau (current approach)?
   - Or best quality tau based on discriminators?

2. **Is VSmu > 1 the correct working point for MuTau channel?**
   - Only 2.2% of taus pass this cut
   - In raw NanoAOD, ~10-15% have VSmu > 0
   - Are we being too strict?

3. **Should we implement best tau selection in fase0?**
   - Loop through all taus
   - Pick tau with best VSmu score (breaking ties with VSjet)
   - Expected to increase event counts by 3-5x

## 4. Expected Plots from Diagnostics

The script will generate:

### Common Variables (all samples):
- `mu_pt.png` - Muon pT distribution
- `mu_eta.png` - Muon eta distribution
- `tau_pt.png` - Tau pT distribution
- `tau_eta.png` - Tau eta distribution
- `mu_iso.png` - Muon isolation
- `delta_r_mutau.png` - Angular separation between muon and tau
- `sist_mass.png` - Invariant mass of mu-tau system
- `sist_acop.png` - Acoplanarity
- `tau_id1.png` - Tau VSjet discriminator
- `tau_id2.png` - Tau VSe discriminator
- **`tau_id3.png`** - **Tau VSmu discriminator (KEY PLOT!)**
- `xi_arm1.png` - Proton xi arm 1
- `xi_arm2.png` - Proton xi arm 2
- `delta_phi_pp.png` - Delta phi between protons

### Proton Variables (Data/QCD only):
- `xi_arm1_1.png` - First proton xi arm 1
- `xi_arm2_1.png` - First proton xi arm 2

### Summary Plots:
- `event_counts.png` - Bar chart showing event counts by sample
- `tau_id3_ratio.png` - Data/MC ratio vs VSmu
- `mu_eta_ratio.png` - Data/MC ratio vs muon eta
- `tau_eta_ratio.png` - Data/MC ratio vs tau eta

## 5. What to Expect in the Plots

### tau_id3.png (VSmu Distribution)
- **Expected**: Data should be concentrated at VSmu=0
- **Expected**: MC (DY/ttjets) should have more uniform distribution
- **Why**: Because fase0 picks highest pT tau, which in MuTau is often fake (VSmu=0)

### mu_eta.png, tau_eta.png
- **Expected**: Similar shapes between Data and MC
- **Why**: Rules out geometric acceptance issues

### event_counts.png
- **Expected**: Data and QCD bars much shorter than DY and ttjets
- **Current**: Data=6,859, QCD=1,011 (using fase1_0.root files)
- **Why**: Shows the factor of 2 discrepancy visually

### Ratio Plots
- **tau_id3_ratio.png**: If ratio varies strongly with VSmu → confirms tau selection issue
- **mu_eta_ratio.png**: If ratio is flat → rules out eta-dependent issues

## 6. After Advisor Meeting

Based on advisor feedback, implement one of these solutions:

### Option A: Best Tau Selection in Fase0 (RECOMMENDED)
Modify [fase0_qcd_data.py](fase0_qcd_data.py) to select best quality tau:
- Loop through all taus
- Pick tau with highest VSmu score (breaking ties with VSjet)
- Expected improvement: 3-5x more events

### Option B: Loosen VSmu Cut (Quick Test)
Change `tau_id3 > 1` to `tau_id3 > 0` in fase1_data.py and fase1_qcd.py
- Expected: ~40% more events
- Not a real solution, just verifies VSmu is the bottleneck

### Option C: Remove Proton Requirement (Nuclear Option)
Comment out `pps_has_both_arms == 1` filter
- Expected: ~6x more events
- Defeats purpose of using real proton data

## 7. Implementation Timeline

1. **Today**: Generate plots, review presentation
2. **Advisor meeting**: Discuss findings, get approval for solution
3. **After approval**: Implement best tau selection in fase0
4. **Reprocessing**: Run fase0 → fase1 → merge pipeline (all 393 files)
5. **Validation**: Check that Data ≥ MC in final plots, remove weight=2.0

## Files Ready for Meeting

- ✅ [SIMPLE_PRESENTATION.pdf](SIMPLE_PRESENTATION.pdf) - 20 slides
- ⏳ [diagnostic_plots/](diagnostic_plots/) - Will be created by run_diagnostics.sh
- ✅ [FINAL_SUMMARY_AND_SOLUTION.md](FINAL_SUMMARY_AND_SOLUTION.md) - Detailed technical analysis
- ✅ [diagnostic_plots.py](diagnostic_plots.py) - Fixed and ready to run

## Summary

**The Issue**: Fase0 picks highest pT tau (tau[0]), which in MuTau events is often a fake with VSmu=0, while real taus at lower pT have good VSmu scores.

**The Evidence**: Only 2.2% of fase0 output passes VSmu > 1, but raw NanoAOD has ~10-15% with VSmu > 0.

**The Solution**: Select best quality tau instead of highest pT tau.

**Expected Outcome**: Event counts increase 3-5x, Data ≥ MC ✓
